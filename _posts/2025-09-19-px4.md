---

title : "px4 for quadcopter"

published : true

toc: true
   toc_label : "On this page"
   toc_icon : "list"   

---

## px4

I organize the content mainly in sequence, and the headlines just serve as cues or brief summaries of what each section contains.  

### px4 & ardupilot

In general, a flight controller tower that supports PX4 can also run ArduPilot, but not necessarily the other way around.  

### autopilot

The "brain" of the drone is called an autopilot.

It minimally consists of flight stack software running on a real time OS ("RTOS") on flight controller (FC) hardware. The flight stack provides essential stabilisation and safety features, and usually also some level of pilot assistance for manual flight and automating common tasks, such as taking off, landing, and executing predefined missions.

Some autopilots also include a general-purpose computing system that can provide "higher level" command and control, and that can support more advanced networking, computer vision, and other features. This might be implemented as a separate companion computer, but in future it is increasingly likely to be a fully integrated component.


### what's px4 consistence

PX4 is a core part of a broader drone platform that includes the QGroundControl ground station, Pixhawk hardware, and MAVSDK for integration with companion computers, cameras and other hardware using the MAVLink protocol. PX4 is supported by the Dronecode Project.

### QGroundControl

QGroundControl communicates with the drone using a telemetry radio (a bidirectional data link).

QGroundControl desktop versions are also used to install (flash) PX4 firmware and configure PX4 on the drone's autopilot/flight controller hardware.

### manual control

Pilots can control a vehicle manually using either a Radio Control (RC) System or a Joystick/Gamepad controller connected via QGroundControl.


QGroundControl allows you to control a vehicle using a joystick or gamepad instead of an RC Transmitter.



### payloads

Payloads are equipment carried by the vehicle to meet user or mission objectives. PX4 supports a wide range of vehicle payloads, including cameras of various types, cargo, instrumentation, and so on.

Payloads are connected to Flight Controller outputs, and can be triggered automatically in missions, manually from an RC Controller or Joystick, or from a Ground Station (via MAVLink/MAVSDK commands).    

### MAVSDK

MAVSDK is primarily written in C++.

### MAVLink

MAVLink was first released early 2009 by Lorenz Meier and has now a significant number of contributors.




### Telemetry Radios/Modems

Telemetry Radios can (optionally) be used to provide a wireless MAVLink connection between a ground control station like QGroundControl and a vehicle running PX4. This makes it possible to tune parameters while a vehicle is in flight, inspect telemetry in real-time, change a mission on the fly, etc.












### most basic control of floating

In the case that the quadcopter floats in the air, the four motors must cooperrate to make aircraft stable.






### uORB

To gain a deep understanding of uORB, you must have a foundation in **multithreaded and multiprocess programming under Linux**.  
This includes understanding inter-process and inter-thread communication mechanisms such as messages, pipes, shared memory, and queues, as well as synchronization tools like mutexes.

### linux multi-threed

In the Linux system, multithreading follows the **POSIX thread interface**, known as **pthread**.  
When writing multithreaded programs in Linux, you need to include the header file **pthread.h** and link against the library **libpthread.a**.  

As a side note, the implementation of pthread in Linux is based on the **clone() system call**.  
`clone()` is a Linux-specific system call whose usage is similar to `fork()`.  
For detailed information about `clone()`, interested readers can refer to the relevant documentation.

### threed

The concept of **threads** was proposed as early as the 1960s, but it was not until the mid-1980s that multithreading was truly applied in operating systems.  
**Solaris** was a pioneer in this field.  

Traditional Unix also supported the concept of threads, but only allowed a single thread within a process. In that model, multithreading essentially meant **multiprocessing**.  

Today, multithreading is supported by many operating systems, including **Windows NT** and, of course, **Linux**.

Back to uORB.

**uORB (Micro Object Request Broker)** is a very important and critical module in the **PX4/Pixhawk system**.  
It carries the responsibility of **data transmission** across the whole system. All sensor data, GPS information, PPM signals, and similar inputs are obtained from the chip and then passed through **uORB** to other modules for computation and processing.  

In essence, **uORB is an inter-process communication (IPC) module**.  
Within Pixhawk, all functionalities are implemented and executed as independent process modules.  
Therefore, the exchange of data between processes becomes crucial, and it must satisfy the requirements of being **real-time** and **ordered**.


### nuttx and uorb

Pixhawk runs on the **NuttX real-time ARM operating system**.  
In practice, **uORB works by allowing multiple processes to open the same device file**, and through this file node, processes can exchange and share data.  

Messages exchanged through the named **bus** are referred to as **topics**.  
In Pixhawk, a **topic** contains only one type of message, essentially corresponding to a **data type**.  

- Each process can **subscribe** to or **publish** a topic.  
- There can be multiple publishers.  
- A single process can subscribe to multiple topics.  
- However, on a single bus, there is always only **one active message** at any time.













## Algorithm


### throw launch

"Throw Launch is also supported, in which the vehicle activates motors after it detects that it has reached the apex of a throw, and then operates according to its current mode."

So, how do we achieve the goal to throw launch?


## Porting

### px4 for esp32

I watched a video to run px4 on esp32.

His hardware:
    IMU:ICM-20602
    mag:IST8310
    baro:MS5611

Really harecore. The core for the feasibility is that nuttx supports esp32 now.




### pixhawk 2.4.8

i2c onboard is a master line, which can be added with a lot of compatibale pheriphlars like super sonic. 

You can buy a extend board to embed more i2c devices.

pixhawk 2.4.8 has 2 usb connervtor, which are same. Can be used to debug and test.

serial connerctor, this is can be used as digital transmit port.



pixhawk 2.4.8 has a adc port which can be added with Airspeed Indicator.

pixhawk, upper outer pin is negative line.

In common, the dirst line is for receiver.


### Connect PixHawk to Raspberry Pi and NVIDIA Jetson

Yes, we can do it.